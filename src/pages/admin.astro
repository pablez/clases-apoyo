---
import Layout from '../layouts/Layout.astro';
import AttendanceManager from '../components/AttendanceManager.jsx';
import AlumnosManager from '../components/AlumnosManager.jsx';
import MaterialesManager from '../components/MaterialesManager.jsx';
import CalendarManager from '../components/CalendarManager.jsx';

const ADMIN_PASSWORD = import.meta.env.ADMIN_PASSWORD || 'admin123';
---

<Layout title="Panel de AdministraciÃ³n">
  <div id="auth-container" class="max-w-md mx-auto px-4 py-8 sm:py-12">
    <div class="bg-white rounded-lg shadow-lg p-6 sm:p-8">
      <div class="text-center mb-6">
        <div class="inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-blue-100 rounded-full mb-4">
          <svg class="w-8 h-8 sm:w-10 sm:h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
          </svg>
        </div>
        <h1 class="text-2xl sm:text-3xl font-bold mb-2">Panel de AdministraciÃ³n</h1>
        <p class="text-gray-600 text-sm sm:text-base">Ingresa la contraseÃ±a para acceder</p>
      </div>
      <form id="login-form" onsubmit="return false;" class="space-y-4">
        <input
          type="text"
          name="username"
          autocomplete="username"
          style="display:none;"
          value="admin"
        />
        <div>
          <label for="password-input" class="block text-sm font-medium text-gray-700 mb-2">
            ContraseÃ±a
          </label>
          <input
            type="password"
            id="password-input"
            name="password"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base"
            autocomplete="current-password"
          />
        </div>
        <button
          id="login-btn"
          type="submit"
          class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-medium text-base sm:text-lg flex items-center justify-center gap-2"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
          </svg>
          Acceder
        </button>
        <p id="error-msg" class="text-red-600 text-sm text-center mt-3 hidden flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          ContraseÃ±a incorrecta
        </p>
      </form>
    </div>
  </div>

  <div id="admin-panel" class="hidden">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 sm:mb-6 gap-3">
      <h1 class="text-2xl sm:text-3xl font-bold">Panel de GestiÃ³n</h1>
      <button
        id="logout-btn"
        class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition text-sm sm:text-base inline-flex items-center justify-center gap-2"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
        <span class="hidden sm:inline">Cerrar SesiÃ³n</span>
        <span class="sm:hidden">Salir</span>
      </button>
    </div>
    
    <!-- PestaÃ±as - Responsive -->
    <div class="mb-4 sm:mb-6 border-b overflow-x-auto">
      <nav class="flex gap-2 sm:gap-4 min-w-max sm:min-w-0">
        <button 
          class="tab-button px-3 sm:px-4 py-2 font-medium border-b-2 border-blue-600 text-blue-600 text-sm sm:text-base whitespace-nowrap"
          data-tab="asistencia"
        >
          <span class="hidden sm:inline">ğŸ“Š Asistencia</span>
          <span class="sm:hidden">ğŸ“Š</span>
        </button>
        <button 
          class="tab-button px-3 sm:px-4 py-2 font-medium border-b-2 border-transparent text-gray-600 hover:text-gray-900 text-sm sm:text-base whitespace-nowrap"
          data-tab="alumnos"
        >
          <span class="hidden sm:inline">ğŸ‘¥ Alumnos</span>
          <span class="sm:hidden">ğŸ‘¥</span>
        </button>
        <button 
          class="tab-button px-3 sm:px-4 py-2 font-medium border-b-2 border-transparent text-gray-600 hover:text-gray-900 text-sm sm:text-base whitespace-nowrap"
          data-tab="materiales"
        >
          <span class="hidden sm:inline">ğŸ“š Materiales</span>
          <span class="sm:hidden">ğŸ“š</span>
        </button>
        <button 
          class="tab-button px-3 sm:px-4 py-2 font-medium border-b-2 border-transparent text-gray-600 hover:text-gray-900 text-sm sm:text-base whitespace-nowrap"
          data-tab="calendario"
        >
          <span class="hidden sm:inline">ğŸ“… Calendario</span>
          <span class="sm:hidden">ğŸ“…</span>
        </button>
      </nav>
    </div>

    <!-- Contenido de pestaÃ±as -->
    <div id="tab-asistencia" class="tab-content">
      <AttendanceManager client:load apiBaseUrl="/api" />
    </div>

    <div id="tab-alumnos" class="tab-content hidden">
      <AlumnosManager client:load apiBaseUrl="/api" />
    </div>

    <div id="tab-materiales" class="tab-content hidden">
      <MaterialesManager client:load apiBaseUrl="/api" />
    </div>

    <div id="tab-calendario" class="tab-content hidden">
      <CalendarManager client:load apiBaseUrl="/api" />
    </div>
  </div>

  <script define:vars={{ ADMIN_PASSWORD }}>
    const authContainer = document.getElementById('auth-container');
    const adminPanel = document.getElementById('admin-panel');
    const passwordInput = document.getElementById('password-input');
    const loginBtn = document.getElementById('login-btn');
    const errorMsg = document.getElementById('error-msg');

    // Check if already authenticated
    if (sessionStorage.getItem('admin_auth') === 'true') {
      authContainer.classList.add('hidden');
      adminPanel.classList.remove('hidden');
    }

    loginBtn.addEventListener('click', () => {
      const password = passwordInput.value;
      if (password === ADMIN_PASSWORD) {
        sessionStorage.setItem('admin_auth', 'true');
        authContainer.classList.add('hidden');
        adminPanel.classList.remove('hidden');
        errorMsg.classList.add('hidden');
      } else {
        errorMsg.classList.remove('hidden');
        passwordInput.value = '';
      }
    });

    passwordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        loginBtn.click();
      }
    });

    // Logout functionality
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', () => {
        if (confirm('Â¿Cerrar sesiÃ³n?')) {
          sessionStorage.removeItem('admin_auth');
          location.reload();
        }
      });
    }

    // Tabs functionality
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const tabName = button.dataset.tab;
        
        // Update button styles
        tabButtons.forEach(btn => {
          if (btn === button) {
            btn.classList.add('border-blue-600', 'text-blue-600');
            btn.classList.remove('border-transparent', 'text-gray-600');
          } else {
            btn.classList.remove('border-blue-600', 'text-blue-600');
            btn.classList.add('border-transparent', 'text-gray-600');
          }
        });

        // Show/hide content
        tabContents.forEach(content => {
          if (content.id === `tab-${tabName}`) {
            content.classList.remove('hidden');
          } else {
            content.classList.add('hidden');
          }
        });
      });
    });
  </script>
</Layout>
